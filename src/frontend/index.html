<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <title>nullad</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <script src="https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit" defer></script>

        <link rel="stylesheet" href="./output.css">

        <style>
            * {
                font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            }

            pre {
                font-family: monospace;
            }
        </style>
    </head>

    <body class="bg-black text-white m-0 flex flex-col items-center mt-16">
        <main class="w-full max-w-lg flex flex-col items-center gap-2 px-4">
            <h1 class="text-4xl font-extrabold tracking-tight text-white text-center select-none">nullad</h1>
            <h2 class="text-lg font-medium text-muted-foreground mb-3 text-center select-none text-neutral-300">the best
                linkvertise bypasser!</h2>
            <div id="linkForm" class="w-full flex flex-row gap-4 items-center mb-1 max-[700px]:flex-col">
                <input type="text" id="linkInput" placeholder="Paste your linkvertise link"
                    class="flex-1 px-5 py-3 border border-white/10 rounded-lg text-base bg-black text-white outline-none focus:border-white focus:ring-2 focus:ring-white/40 transition-all duration-150 text-center placeholder:text-[#666] placeholder:font-normal shadow-sm">
                <button type="submit"
                    class="px-8 py-3 rounded-lg bg-white text-black text-base font-bold cursor-pointer transition-all duration-150 hover:bg-neutral-900 hover:text-white border border-white/10 shadow-sm focus:outline-none focus:ring-2 focus:ring-white/70">
                    Submit
                </button>
            </div>

            <div class="loading hidden text-yellow-500 rounded-lg text-base text-center px-4 py-1 font-medium"></div>

            <div class="turnstile mt-1"></div>

            <div class="error hidden text-red-500 rounded-lg mt-1 text-base text-center px-4 py-1 font-medium"></div>
            <div class="result hidden text-green-500 rounded-lg mt-1 text-base text-center px-4 py-1 font-medium"></div>
        </main>

        <script>
            let sitekey;

            fetch('/api/sitekey').then(res => res.json()).then(data => sitekey = data.sitekey);

            const turnstileDiv = document.querySelector('.turnstile');
            const linkInput = document.querySelector('input');
            const button = document.querySelector('button');
            const loading = document.querySelector('.loading');
            const error = document.querySelector('.error');
            const result = document.querySelector('.result');

            const loadingText = 'the bypass is loading, please be patient!<br>(we gotta talk to linkvertise\'s servers, give us 15 seconds)';
            const captchaText = 'please prove you\'re not one of those silly bots with this hopefully very fast captcha!';

            button.addEventListener('click', async (e) => {
                if (!sitekey) {
                    error.style.display = 'flex';
                    error.textContent = '✗ sitekey not loaded yet, please try again in a moment.';
                    return;
                }

                result.style.display = 'none';
                error.style.display = 'none';

                loading.style.display = 'flex';
                loading.innerHTML = captchaText;

                const token = await new Promise((tokenCallback) => turnstile.render('.turnstile', {
                    sitekey,
                    callback: (token) => tokenCallback(token)
                }));

                if (!token) {
                    loading.style.display = 'none';
                    error.style.display = 'flex';
                    error.textContent = '✗ captcha failed, please reload & try again.';
                    return;
                }

                loading.innerHTML = loadingText;
                turnstileDiv.replaceChildren();

                try {
                    const res = await fetch('/api/bypass', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ link: linkInput.value.trim(), token })
                    });

                    if (!res.ok) error.textContent = '✗ server error: ' + res.status;

                    loading.style.display = 'none';

                    const data = await res.json();
                    if (data.error) {
                        error.innerHTML = '✗ ' + data.error;
                        error.style.display = 'block';
                    } else {
                        result.style.display = 'block';

                        if (data.link) result.innerHTML = `✔ it worked, let\'s go!<br><a href="${data.link}" class="underline font-bold">${data.link}</a>`;
                        else result.innerHTML = `✔ it worked, let\'s go!<br><pre class="p-3 bg-neutral-900 mt-3 rounded-sm">${data.text}</pre>`;
                    }
                } catch (err) {
                    error.textContent = 'failed to fetch result. Please try again.';
                }
            });
        </script>
    </body>

</html>